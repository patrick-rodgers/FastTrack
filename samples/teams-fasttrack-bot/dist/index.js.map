{"version":3,"file":"index.js","sources":["../src/bot.ts","../src/index.ts"],"sourcesContent":["\r\nimport {\r\n    ChatConnector,\r\n    UniversalBot,\r\n    MemoryBotStorage,\r\n    Middleware,\r\n} from \"botbuilder\";\r\n\r\nimport {\r\n    createServer,\r\n} from \"restify\";\r\n\r\nimport {\r\n    Logger,\r\n    LogLevel,\r\n} from \"@pnp/logging\";\r\n\r\nlet _botPromise: Promise<UniversalBot> | null = null;\r\n\r\n// export type BotDelegate = (b: UniversalBot, resolve: () => void, reject: (reason?: any) => void) => void;\r\n\r\nexport type BotDelegate = (b: UniversalBot) => void;\r\n\r\nfunction getBot(): Promise<UniversalBot> {\r\n\r\n    Logger.write(\"Entering getBot()\", LogLevel.Verbose);\r\n\r\n    if (_botPromise === null) {\r\n\r\n        Logger.write(\"getBot() :: Bot promise is null, returning.\", LogLevel.Verbose);\r\n\r\n        _botPromise = new Promise((resolve) => {\r\n\r\n            const connector = new ChatConnector({\r\n                appId: \"55d2e898-d1f3-4bb7-bfdb-4f1e6948b7aa\",\r\n                appPassword: \"prwXN316]rnqeYDWQL58:;!\",\r\n                gzipData: true,\r\n            });\r\n\r\n            const bot = new UniversalBot(connector);\r\n\r\n            // TODO:: testing??\r\n            bot.set(\"storage\", new MemoryBotStorage());\r\n\r\n            // Setup Restify Server\r\n            const server = createServer();\r\n            server.listen(process.env.port || 3978, function () {\r\n                console.log(`${server.name} listening to ${server.url}`);\r\n            });\r\n            server.post(\"/api/messages\", connector.listen());\r\n\r\n            bot.use(Middleware.dialogVersion({ version: 0.2, resetCommand: /^reset/i }));\r\n\r\n            Logger.write(\"getBot() :: Created new bot instance.\", LogLevel.Info);\r\n\r\n            resolve(bot);\r\n        });\r\n    }\r\n\r\n    Logger.write(\"getBot() :: Returning bot promise\", LogLevel.Verbose);\r\n\r\n    return _botPromise;\r\n}\r\n\r\nexport function usingBot(func: BotDelegate): void {\r\n\r\n    getBot().then(b => func(b));\r\n}\r\n","import { usingBot } from \"./bot\";\r\nimport { Session, IPromptResult, IFindMatchResult, Prompts } from \"botbuilder\";\r\n\r\nimport {\r\n    Logger,\r\n    ConsoleListener,\r\n    LogLevel,\r\n} from \"@pnp/logging\";\r\n\r\nexport default function init() {\r\n\r\n    Logger.activeLogLevel = LogLevel.Verbose;\r\n    Logger.subscribe(new ConsoleListener());\r\n\r\n    Logger.write(\"Entering init()\", LogLevel.Verbose);\r\n\r\n    usingBot(bot => {\r\n\r\n        Logger.write(\"init() :: Entering usingBot call\", LogLevel.Verbose);\r\n\r\n        // Entry point of the bot\r\n        bot.dialog(\"/\", [\r\n            (session) => {\r\n                Logger.write(\"init() :: /\", LogLevel.Verbose);\r\n                session.replaceDialog(\"/promptButtons\");\r\n            },\r\n        ]);\r\n\r\n        bot.dialog(\"/promptButtons\", [\r\n            (session: Session) => {\r\n                Logger.write(\"init() :: /promptButtons\", LogLevel.Verbose);\r\n                const choices = [\"Musician Explorer\", \"Musician Search\"];\r\n                Prompts.choice(session, \"How would you like to explore the classical music bot?\", choices);\r\n            },\r\n            (session: Session, results: IPromptResult<IFindMatchResult>) => {\r\n                if (results.response) {\r\n                    const selection = results.response.entity;\r\n                    // route to corresponding dialogs\r\n                    switch (selection) {\r\n                        case \"Musician Explorer\":\r\n                            session.replaceDialog(\"/musicianExplorer\");\r\n                            break;\r\n                        case \"Musician Search\":\r\n                            session.replaceDialog(\"/musicianSearch\");\r\n                            break;\r\n                        default:\r\n                            session.reset(\"/\");\r\n                            break;\r\n                    }\r\n                }\r\n            },\r\n        ]);\r\n    });\r\n}\r\n"],"names":["Logger","ChatConnector","UniversalBot","MemoryBotStorage","createServer","Middleware","ConsoleListener","Prompts"],"mappings":"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"}